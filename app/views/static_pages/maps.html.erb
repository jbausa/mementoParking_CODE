<script type="text/javascript" src='http://ajax.googleapis.com/ajax/libs/jquery/2.0.0/jquery.min.js'> </script>
<script type="text/javascript" src="http://maps.googleapis.com/maps/api/js?key=AIzaSyAVdlyqpDfn1sXmYcY9WJS4cfU0jnkIWao"></script>
<%= javascript_include_tag 'maps.js' %>

<div class="jumbotron fixed-top">
	<div class="panel panel-default">
		<div class="panel-heading">
			<h3 class="panel-title"><span class="fa fa-map-marker" aria-hidden="true" style="margin-right: 10px"></span>Mi mapa</h3>
		</div>
		<div class="panel-body">
			<div class="well">
				<div id="map-canvas"></div>
			</div>
			<script type="text/javascript">getLocation()</script>

		</div>
	</div>

	<div class="panel panel-default">
		<div class="panel-heading">
			<h3 class="panel-title"><span class="fa fa-car" aria-hidden="true" style="margin-right: 10px"></span>Mis ubicaciones</h3>
		</div>	
		<div class="panel-body">
			<!-- INFO, WARNING, ALERT AND ERROR PANELS -->
			<div class="alert alert-info" id="lblPosition" style="font-size: 12px !important; display:none;"></div>
			<div class="alert alert-danger alert-dismissible" role="alert" id="alertCoord" style="display:none;">
				<button type="button" class="close" onclick="$(this).parent().hide()" aria-label="Close"><span aria-hidden="true">&times;</span></button>
				<strong>¡Error!</strong> Selecciona una ubicación antes de guardar.
			</div>
			<div class="alert alert-danger alert-dismissible" role="alert" id="alertCar" style="display:none;"	>
				<button type="button" class="close" onclick="$(this).parent().hide()" aria-label="Close"><span aria-hidden="true">&times;</span></button>
				<strong>¡Error!</strong> Selecciona un coche antes de guardar.
			</div>
			<!-- END OF PANELS -->

			<!-- START LIST UBICATIONS -->
			<div class="row vdivide well well-fixed">
				<div class="col-md-9">
					<ul class="list-unstyled form-group">
						<% @car = User.find_by(email: current_user.email).car %>
						<% if @car.count == 0 %>
						<li class="label label-danger">No tienes ubicaciones guardadas</li>
						<% end %>
						<% else %>
						<% @car.each_with_index do |car, index| %>
						<% if index != 0 %> <li class="separator"/>	<% end %>
						<li>
							<h3><label class="label label-primary" style="display: inline-block; width: 100%"><i class="fa fa-car label-car" style="white-space: normal">&nbsp;&nbsp;<%= car.description.upcase %></i></label></h3>
							<label type="radio" for="<%= car.description %>" class="radio-inline" onclick="addMarkerCar('<%= car.address %>', this.id, '<%= current_user.email %>')" id="<%= car.id %>"> 

								<% if(car.address) %> 
								<%= car.address %>
								<% else %>
								<%= "Selecciona una nueva ubicación" %> 
								<% end %>
							</label>
							<script type="text/javascript">addMarkerDB('<%= car.address %>', '<%= car.description %>')</script>
						</li>
						<% end %>

						<h3><label class="label label-warning" style="display: inline-block; width: 100%"><i class="fa fa-share-alt" id="description" style="white-space: normal">&nbsp;&nbsp;Compartidos conmigo:</i></label></h3>

						<% @userSharing = User.where(:'car.shared' => current_user.email).all %>
						<% index=0%>
						<% @userSharing.each do |userSharing| %>

						<% @car = User.find(userSharing.id).car %>
						<% @car.each do |carSharing| %>
						<% if carSharing.shared %>
						<% if carSharing.shared.include?(current_user.email) && userSharing.email != current_user.email%>
						<% if index != 0 %> <li class="separator"/>	<% end %>
						<li>
							<h3><label class="label label-primary" style="display: inline-block; width: 100%"><i style="white-space: normal" class="fa fa-car label-car">&nbsp;&nbsp;<%= carSharing.description.upcase %> (Compartido por: <% if userSharing.name %> 
												<%= userSharing.name %>
											<% else %>
												<%= userSharing.email %>
											<% end %>
											)</i></label></h3>
							<label type="radio" for="<%= carSharing.description %>" class="radio-inline" onclick="addMarkerCar('<%= carSharing.address %>', this.id, '<%= userSharing.email %>')" id="<%= carSharing.id %>"> 
								<% if(carSharing.address) %> 
								<%= carSharing.address %>
								<% else %>
								<%= "Selecciona una nueva ubicación" %> 
								<% end %>
							</label>
							<script type="text/javascript">addMarkerDB('<%= carSharing.address %>', '<%= carSharing.description %>')</script>
						</li>
						<% index = index+1 %>
						<% end %>
						<% end %>
						<% end %>
						<!-- Crear un bucle para recorrer todos los coches compartidos conmigo por el Usuario -->



						<script type="text/javascript">setMapOnAll()</script>
						<% end %>
					</ul>
				</div>

				<!-- END LIST UBICATIONS -->
				<div class="col-md-3 text-center">
					<div class="btn btn-primary btn-fixed" onclick="getLocation()"><span class="glyphicon glyphicon-screenshot fa-fixed"></span>Centrar</div>
					<div class="btn btn-primary btn-fixed" onclick="saveLocation()"><span class="fa fa-map-marker fa-fixed"></span>Guardar marcador</div>  
					<div class="btn btn-primary btn-fixed" onclick="clearMarkers()"><span class="fa fa-map-o fa-fixed"></span>Limpiar mapa</div>
					<div class="btn btn-primary btn-fixed" onclick="setMapOnAll()"><span class="fa fa-eye fa-fixed"></span>Mostrar ubicaciones</div>
				</div>
			</div>	
		</div>
	</div>	
</div>
</div>

<script type="text/javascript">


</script>